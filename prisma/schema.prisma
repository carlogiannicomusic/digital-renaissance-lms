// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  STUDENT
  TEACHER
  ADMINISTRATOR
}

enum UserStatus {
  PENDING
  ACTIVE
  INACTIVE
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum ChatRoomType {
  GROUP
  PRIVATE
  ANNOUNCEMENT
}

enum DocumentType {
  PASSPORT
  VISA
  CONTRACT
  CONSENT
  PHOTO
  EMIRATES_ID
  ADDRESS
  EMERGENCY_CONTACT
  PAYMENT
  ACADEMIC_INFO
}

enum ClassType {
  GROUP
  PRIVATE
}

enum MaterialType {
  PDF
  VIDEO
  AUDIO
  DOCUMENT
  IMAGE
  OTHER
}

enum AssignmentStatus {
  PENDING
  SUBMITTED
  GRADED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
}

model User {
  id            String      @id @default(uuid())
  email         String      @unique
  name          String
  password      String
  role          UserRole    @default(STUDENT)
  status        UserStatus  @default(PENDING)
  phone         String?
  avatarUrl     String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  coursesTeaching   Course[]          @relation("CourseTeacher")
  enrollments       Enrollment[]
  sentMessages      Message[]         @relation("MessageSender")
  chatParticipants  ChatParticipant[]
  documents         Document[]
  grades            Grade[]
  attendanceRecords Attendance[]
  assignmentSubmissions AssignmentSubmission[]

  @@map("users")
}

model Course {
  id            String    @id @default(uuid())
  title         String
  description   String?
  teacherId     String
  teacher       User      @relation("CourseTeacher", fields: [teacherId], references: [id], onDelete: Cascade)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  schedules     CourseSchedule[]
  enrollments   Enrollment[]
  groups        StudentGroup[]
  chatRooms     ChatRoom[]
  materials     CourseMaterial[]
  grades        Grade[]
  attendances   Attendance[]
  assignments   Assignment[]

  @@map("courses")
}

model CourseSchedule {
  id            String      @id @default(uuid())
  courseId      String
  course        Course      @relation(fields: [courseId], references: [id], onDelete: Cascade)
  startTime     DateTime
  endTime       DateTime
  dayOfWeek     DayOfWeek
  location      String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@map("course_schedules")
}

model Enrollment {
  id            String         @id @default(uuid())
  studentId     String
  student       User           @relation(fields: [studentId], references: [id], onDelete: Cascade)
  courseId      String
  course        Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
  groupId       String?
  group         StudentGroup?  @relation(fields: [groupId], references: [id], onDelete: SetNull)
  enrolledAt    DateTime       @default(now())

  @@unique([studentId, courseId])
  @@map("enrollments")
}

model StudentGroup {
  id            String           @id @default(uuid())
  courseId      String
  course        Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  name          String
  description   String?
  maxCapacity   Int?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt

  schedules     GroupSchedule[]
  enrollments   Enrollment[]

  @@unique([courseId, name])
  @@map("student_groups")
}

model GroupSchedule {
  id            String         @id @default(uuid())
  groupId       String
  group         StudentGroup   @relation(fields: [groupId], references: [id], onDelete: Cascade)
  startTime     DateTime
  endTime       DateTime
  dayOfWeek     DayOfWeek
  location      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@map("group_schedules")
}

model ChatRoom {
  id          String        @id @default(uuid())
  name        String
  type        ChatRoomType
  courseId    String?
  course      Course?       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  messages      Message[]
  participants  ChatParticipant[]

  @@map("chat_rooms")
}

model Message {
  id          String    @id @default(uuid())
  chatRoomId  String
  chatRoom    ChatRoom  @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)
  senderId    String
  sender      User      @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  content     String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("messages")
}

model ChatParticipant {
  chatRoomId  String
  chatRoom    ChatRoom  @relation(fields: [chatRoomId], references: [id], onDelete: Cascade)
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  joinedAt    DateTime  @default(now())

  @@id([chatRoomId, userId])
  @@map("chat_participants")
}

model Document {
  id            String        @id @default(uuid())
  userId        String
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  documentType  DocumentType
  fileUrl       String
  fileName      String
  fileSize      Int?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("documents")
}

model Room {
  id            String    @id @default(uuid())
  name          String    @unique
  capacity      Int
  equipment     String[]  @default([])
  isAvailable   Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  classes       Class[]

  @@map("rooms")
}

model Class {
  id            String      @id @default(uuid())
  title         String
  teacherId     String
  teacherName   String
  roomId        String
  room          Room        @relation(fields: [roomId], references: [id], onDelete: Cascade)
  dayOfWeek     DayOfWeek
  startTime     String
  endTime       String
  classType     ClassType
  color         String
  studentCount  Int         @default(0)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  @@map("classes")
}

model CourseMaterial {
  id            String        @id @default(uuid())
  courseId      String
  course        Course        @relation(fields: [courseId], references: [id], onDelete: Cascade)
  title         String
  description   String?
  materialType  MaterialType
  fileUrl       String
  fileName      String
  fileSize      Int?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("course_materials")
}

model Grade {
  id            String    @id @default(uuid())
  studentId     String
  student       User      @relation(fields: [studentId], references: [id], onDelete: Cascade)
  courseId      String
  course        Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  assignmentId  String?
  assignment    Assignment? @relation(fields: [assignmentId], references: [id], onDelete: SetNull)
  grade         Float
  maxGrade      Float     @default(100)
  feedback      String?
  gradedAt      DateTime  @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("grades")
}

model Attendance {
  id            String            @id @default(uuid())
  studentId     String
  student       User              @relation(fields: [studentId], references: [id], onDelete: Cascade)
  courseId      String
  course        Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  date          DateTime
  status        AttendanceStatus
  notes         String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@unique([studentId, courseId, date])
  @@map("attendances")
}

model Assignment {
  id            String                  @id @default(uuid())
  courseId      String
  course        Course                  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  title         String
  description   String?
  dueDate       DateTime
  maxGrade      Float                   @default(100)
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt

  submissions   AssignmentSubmission[]
  grades        Grade[]

  @@map("assignments")
}

model AssignmentSubmission {
  id            String            @id @default(uuid())
  assignmentId  String
  assignment    Assignment        @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  studentId     String
  student       User              @relation(fields: [studentId], references: [id], onDelete: Cascade)
  fileUrl       String?
  submissionText String?
  status        AssignmentStatus  @default(PENDING)
  submittedAt   DateTime?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@unique([assignmentId, studentId])
  @@map("assignment_submissions")
}

model InvitationToken {
  id            String            @id @default(uuid())
  email         String
  token         String            @unique
  role          UserRole          @default(STUDENT)
  status        InvitationStatus  @default(PENDING)
  invitedBy     String?
  expiresAt     DateTime
  acceptedAt    DateTime?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@map("invitation_tokens")
}
